<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ MeDo Automation Bot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .gradient-bg {
            background: linear-gradient(-45deg, #7c3aed, #2563eb, #059669, #7c3aed);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div class="glass rounded-2xl p-8 max-w-md w-full text-white">
        <h1 class="text-4xl font-bold text-center mb-2">ü§ñ MeDo Bot</h1>
        <p class="text-center text-white/70 mb-8">Automate your account creation</p>

        <form id="automationForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Number of Accounts</label>
                <input 
                    type="number" 
                    id="accounts" 
                    value="10" 
                    min="1" 
                    max="50"
                    class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 focus:border-white/50 focus:outline-none transition"
                />
            </div>

            <div>
                <label class="block text-sm font-medium mb-2">Workers (1-5)</label>
                <input 
                    type="number" 
                    id="workers" 
                    value="3" 
                    min="1" 
                    max="5"
                    class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 focus:border-white/50 focus:outline-none transition"
                />
            </div>

            <div>
                <label class="block text-sm font-medium mb-2">Invite Link</label>
                <input 
                    type="text" 
                    id="inviteLink" 
                    placeholder="https://medo.dev/?invitecode=user-xxxxx"
                    class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 focus:border-white/50 focus:outline-none transition"
                />
            </div>

            <button 
                type="submit"
                id="submitBtn"
                class="w-full bg-white text-purple-700 font-bold py-3 rounded-lg hover:bg-white/90 transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
                üöÄ Start Automation
            </button>
        </form>

        <div id="status" class="mt-6 hidden">
            <div class="bg-white/10 rounded-lg p-4">
                <p id="statusText" class="text-center"></p>
            </div>
        </div>

        <div id="results" class="mt-6 hidden">
            <div class="bg-white/10 rounded-lg p-4">
                <h3 class="font-bold mb-2">üìä Accounts Created:</h3>
                <pre id="resultsText" class="text-xs overflow-x-auto font-mono"></pre>
                <button 
                    onclick="copyResults()"
                    class="mt-3 w-full bg-white/20 py-2 rounded hover:bg-white/30 transition"
                >
                    üìã Copy Results
                </button>
            </div>
        </div>

        <div class="mt-8 pt-6 border-t border-white/20">
            <div class="flex justify-between text-sm text-white/70">
                <a href="https://github.com/ryzexxs/medo-signup-bot/actions" target="_blank" class="hover:text-white transition">
                    üîó View Actions
                </a>
                <span>Powered by GitHub Actions</span>
            </div>
        </div>
    </div>

    <script>
        const GITHUB_OWNER = 'ryzexxs';
        const GITHUB_REPO = 'medo-signup-bot';
        const WORKFLOW_FILE = 'medo-automation.yml';
        
        // Get token from environment or prompt
        const GITHUB_TOKEN = localStorage.getItem('github_token') || prompt('Enter GitHub Token (get from https://github.com/settings/tokens):');
        if (GITHUB_TOKEN) {
            localStorage.setItem('github_token', GITHUB_TOKEN);
        }

        document.getElementById('automationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const accounts = document.getElementById('accounts').value;
            const workers = document.getElementById('workers').value;
            const inviteLink = document.getElementById('inviteLink').value;
            
            const submitBtn = document.getElementById('submitBtn');
            const statusDiv = document.getElementById('status');
            const statusText = document.getElementById('statusText');
            const resultsDiv = document.getElementById('results');
            
            submitBtn.disabled = true;
            statusDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
            statusText.innerHTML = '‚è≥ Starting automation...';
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/actions/workflows/${WORKFLOW_FILE}/dispatches`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${GITHUB_TOKEN}`,
                            'Accept': 'application/vnd.github.v3+json',
                        },
                        body: JSON.stringify({
                            ref: 'main',
                            inputs: {
                                accounts: accounts,
                                workers: workers,
                                invite_link: inviteLink
                            }
                        })
                    }
                );

                if (response.ok) {
                    statusText.innerHTML = '‚úÖ Automation started successfully!<br><br><a href="https://github.com/ryzexxs/medo-signup-bot/actions" target="_blank" class="underline">üìä View Progress in GitHub Actions ‚Üí</a>';
                    statusText.className = 'text-center text-green-300';
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to start');
                }
            } catch (error) {
                statusText.innerHTML = `‚ùå Error: ${error.message}`;
                statusText.className = 'text-center text-red-300';
                submitBtn.disabled = false;
            }
        });

        function copyResults() {
            const results = document.getElementById('resultsText').innerText;
            navigator.clipboard.writeText(results);
            alert('‚úÖ Results copied to clipboard!');
        }

        // Check for latest run results
        async function checkLatestRun() {
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/actions/workflows/${WORKFLOW_FILE}/runs?per_page=1`,
                    {
                        headers: {
                            'Authorization': `token ${GITHUB_TOKEN}`,
                            'Accept': 'application/vnd.github.v3+json',
                        }
                    }
                );
                const data = await response.json();
                if (data.workflow_runs && data.workflow_runs.length > 0) {
                    const run = data.workflow_runs[0];
                    if (run.status === 'completed') {
                        // Fetch job logs
                        const jobsResponse = await fetch(
                            `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/actions/runs/${run.id}/jobs`,
                            {
                                headers: {
                                    'Authorization': `token ${GITHUB_TOKEN}`,
                                }
                            }
                        );
                        const jobs = await jobsResponse.json();
                        if (jobs.jobs && jobs.jobs.length > 0) {
                            // Show results from logs
                            const logsUrl = jobs.jobs[0].steps?.[4]?.steps?.[0]?.log?.url;
                            if (logsUrl) {
                                const logsResponse = await fetch(logsUrl, {
                                    headers: {
                                        'Authorization': `token ${GITHUB_TOKEN}`,
                                        'Accept': 'application/vnd.github.v3+json',
                                    }
                                });
                                const logs = await logsResponse.text();
                                const accountsMatch = logs.match(/Accounts created:[\s\S]*?=====/);
                                if (accountsMatch) {
                                    document.getElementById('resultsText').innerText = accountsMatch[0];
                                    document.getElementById('results').classList.remove('hidden');
                                }
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Error checking run:', error);
            }
        }

        // Check for results on page load
        checkLatestRun();
    </script>
</body>
</html>
